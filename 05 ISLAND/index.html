<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8"/>
		<title>Zettel 6 - Aufgabe 1</title>
		
		<script id="vertex-shader" type="x-shader/x-vertex">




			attribute vec4 vPosition;
			attribute vec4 vColor;
			attribute vec4 vNormal;
						
			uniform mat4 modelMatrix;
			uniform mat4 viewMatrix;
			uniform mat4 projectionMatrix;

			const vec4 k_a = vec4(0.5,0.5,0.5,1.0);
			const vec4 k_d = vec4(0.8,0.8,0.8,1.0);
			const vec4 k_s = vec4(0.2,0.2,0.2,1.0);

			const vec4 I_d = vec4(0.9,0.9,0.9,1.0);
			const vec4 I_s = vec4(1.0,1.0,1.0,1.0);

			//f√ºr denn fatti Wert
			const float c_1 = 0.6;
			const float c_2 = 0.00005;
			const float c_3 = 0.00000002;

			const float n = 4.0;
 
			uniform vec4 lightPos;
			uniform vec4 lightColor;
			uniform vec4 ambientLightInt;

			varying vec4 fColor;
			varying vec4 lightIntensity;

			varying vec4 N;
			varying vec4 L;
			varying vec4 R;
			varying vec4 V;

			varying float distance;
			varying float fatti;
			varying float vertexToLight;

			void main()
			{
				mat4 modelViewMatrix = viewMatrix * modelMatrix;
				vec4 position = modelViewMatrix * vPosition;

				gl_Position = projectionMatrix * position;
				
				vec4 LightPos = modelViewMatrix * lightPos;

				vec4 Noo =  vec4(1.0, 1.0, 1.0, 0.0) * vNormal;

				N = normalize(modelViewMatrix * Noo) + vec4(0.0, 0.0, 0.0, 1.0);

				L = position - LightPos;
				vec4 Lnorm = normalize(L * vec4(1.0 ,1.0 ,1.0 ,0.0) + vec4(0.0, 0.0, 0.0, 1.0));

				R = reflect(Lnorm, N);

				V = normalize( vec4(-1.0, -1.0, -1.0, 1.0) * position);
				
				distance = length(L);
				
				fatti = min(1.0 / (c_1 + (c_2 * distance) + (c_3 + pow(distance, 2.0))), 1.0);

				lightIntensity = ambientLightInt * k_a + 0.5 *
								(I_d * k_d * max(0.0, dot(N, Lnorm))
								+ I_s * k_s * pow(max(0.0, dot(R, V)), n));

				fColor = vColor * lightIntensity ;

			}
		</script>
		<script id="fragment-shader" type="x-shader/x-fragment">
			precision mediump float;
			
			varying vec4 fColor;

			/*
			varying vec4 N;

			struct DirectionalLight {
			vec4 direction;
			vec4 color;
			} 

			uniform vec4 direction;
			uniform vec4 color;
			uniform vec4 ambientLightInt;
			
			*/

			void main()
			{				

			//	vec4 lightIntensity = ambientLightInt + color * max(dot(N, direction), 0.0);
			
				gl_FragColor = fColor; //* lightIntensity;

			}
		</script>

		<script type="text/javascript" src="common/initShaders.js">
		</script>
		<script type="text/javascript" src="common/gl-matrix.js">
		</script>
	</head>
	<body>

		<canvas id="gl-canvas" width="1600" height="900">
			If you see this, your browser doesn't support WebGL.
		</canvas>

		<script type="text/javascript" src="polygon.js"></script>
		<script type="text/javascript" src="cube.js"></script>
		<script type="text/javascript" src="palm.js"></script>
		<script type="text/javascript" src="cameramanager.js"></script>
		<script type="text/javascript" src="app.js"></script>
		
	</body>
</html>
