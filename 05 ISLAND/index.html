<!DOCTYPE HTML>
<html>
	<head>
		<meta charset="utf-8"/>
		<title>Zettel 6 - Aufgabe 1</title>
		
		<script id="vertex-shader" type="x-shader/x-vertex">




			attribute vec4 vPosition;
			attribute vec4 vColor;
			attribute vec4 vNormal;
						
			uniform mat4 modelMatrix;
			uniform mat4 viewMatrix;
			uniform mat4 projectionMatrix;

			const vec4 k_a = vec4(0.2,0.2,0.2,1.0);
			const vec4 k_d = vec4(0.8,1.0,0.8,1.0);
			const vec4 k_s = vec4(0.3,0.2,0.4,1.0);

			const vec4 I_d = vec4(0.1,0.1,0.5, 1.0);
			const vec4 I_s = vec4(1.0,0.1,1.0, 1.0);


			//für denn fatti Wert
			const float c_1 = 1.0;
			const float c_2 = 0.00005;
			const float c_3 = 0.00000002;


			const float n = 4.0;
 
			uniform vec4 direction;
			uniform vec4 color;
			uniform vec4 ambienLightIntensity;


			varying vec4 fColor;
			varying vec4 fNormals;
			varying vec4 lightIntensity;
			varying vec4 lightDirection;
			varying vec4 reflectedLight;
			varying vec4 reflectedCamPos;

			varying float distance;
			varying float fatti;

			

			void main()
			{
				//eig fNormals = normalize(projectionMatrix * viewMatrix * modelMatrix * vNormal); für kamcord
				//sieht aber nur nach ambient aus 
				fNormals = vNormal ;

				lightDirection = normalize(projectionMatrix * viewMatrix * direction);
				reflectedLight = normalize(reflect(lightDirection, fNormals));

				reflectedCamPos = normalize(vec4(-1.0, -1.0, -1.0, -1.0) * viewMatrix);
				
				distance = length(lightDirection);
				
				fatti = min(1.0 / (c_1 + (c_2 * distance) + (c_3 + pow(distance, 2.0))), 1.0);

				lightIntensity = ambienLightIntensity * k_a + fatti *
								(I_d * k_d * max(0.0, dot(fNormals, lightDirection))
								+ I_s * k_s * pow(max(0.0, dot(reflectedLight, reflectedCamPos)), n));


				fColor = vColor * lightIntensity;
				
				gl_Position = (projectionMatrix * viewMatrix * modelMatrix * vPosition) ;
			}
		</script>
		<script id="fragment-shader" type="x-shader/x-fragment">
			precision mediump float;
			
			varying vec4 fColor;

			/*
			varying vec4 fNormals;

			struct DirectionalLight {
			vec4 direction;
			vec4 color;
			} 

			uniform vec4 direction;
			uniform vec4 color;
			uniform vec4 ambienLightIntensity;
			
			*/

			void main()
			{				

			//	vec4 lightIntensity = ambienLightIntensity + color * max(dot(fNormals, direction), 0.0);
			
				gl_FragColor = fColor; //* lightIntensity;

			}
		</script>

		<script type="text/javascript" src="common/initShaders.js">
		</script>
		<script type="text/javascript" src="common/gl-matrix.js">
		</script>
	</head>
	<body>

		<canvas id="gl-canvas" width="1600" height="900">
			If you see this, your browser doesn't support WebGL.
		</canvas>

		<script type="text/javascript" src="polygon.js"></script>
		<script type="text/javascript" src="cube.js"></script>
		<script type="text/javascript" src="palm.js"></script>
		<script type="text/javascript" src="cameramanager.js"></script>
		<script type="text/javascript" src="app.js"></script>
		
	</body>
</html>
